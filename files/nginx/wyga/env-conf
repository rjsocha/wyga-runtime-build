#!/bin/sh
set -eu
if [ -n "${ENVCFGFILE:-}" ]
then
  for _entry in ${ENVCFGFILE//,/ }
  do
    read _file _env < <(echo "${_entry//:/ }")
    echo "Processing ${_env} as file ${_file}"
    _dir="$(dirname "${_file}")"
    mkdir -p "${_dir}"
    for _conf in $(env | egrep -o "^${_env}[0-9]+" | sort)
    do
      eval echo \"\$${_conf}\"
    done >"${_file}"
  done
fi
